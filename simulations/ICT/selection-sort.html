<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Selection Sort Master</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* Light Blue/Slate tint */
            color: #1e293b; /* Slate 800 */
        }
        .pixel-font {
            font-family: 'Press Start 2P', cursive;
        }
        .bar-container {
            transition: all 0.3s ease;
        }
        .bar {
            transition: height 0.5s ease, background-color 0.3s ease, transform 0.3s ease;
        }
        /* Custom scrollbar for instructions */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Icon Component to avoid DOM conflicts ---
        const Icon = ({ name, className }) => {
            const commonProps = {
                xmlns: "http://www.w3.org/2000/svg",
                width: "24",
                height: "24",
                viewBox: "0 0 24 24",
                fill: "none",
                stroke: "currentColor",
                strokeWidth: "2",
                strokeLinecap: "round",
                strokeLinejoin: "round",
                className: className
            };

            const icons = {
                info: (
                    <svg {...commonProps}>
                        <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
                    </svg>
                ),
                trophy: (
                    <svg {...commonProps}>
                        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
                    </svg>
                ),
                "arrow-up": (
                    <svg {...commonProps}>
                        <path d="m5 12 7-7 7 7"/><path d="M12 19V5"/>
                    </svg>
                ),
                "refresh-cw": (
                    <svg {...commonProps}>
                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/>
                    </svg>
                ),
                play: (
                    <svg {...commonProps}>
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                ),
                "gamepad-2": (
                    <svg {...commonProps}>
                        <line x1="6" x2="10" y1="11" y2="11"/><line x1="8" x2="8" y1="9" y2="13"/><line x1="15" x2="15.01" y1="13" y2="13"/><line x1="18" x2="18.01" y1="11" y2="11"/><rect width="20" height="12" x="2" y="6" rx="2"/>
                    </svg>
                ),
                "gauge": (
                    <svg {...commonProps}>
                         <path d="m12 14 4-4"/><path d="M3.34 19a10 10 0 1 1 17.32 0"/>
                    </svg>
                )
            };
            return icons[name] || null;
        };

        const App = () => {
            // --- Configuration ---
            const ARRAY_SIZE = 10;
            const MIN_VAL = 10;
            const MAX_VAL = 100;
            
            const SPEEDS = {
                SLOW: 800,
                NORMAL: 400,
                FAST: 100
            };

            // --- State ---
            const [array, setArray] = useState([]);
            const [gameState, setGameState] = useState('IDLE'); // IDLE, AUTO_SORT, PLAYING, WON
            const [playPhase, setPlayPhase] = useState('FIND_MIN'); // FIND_MIN, SWAP_TARGET
            
            // Indices for visualization
            const [sortedIndex, setSortedIndex] = useState(0); // Everything before this is sorted
            const [currentIndex, setCurrentIndex] = useState(null); // The scanner (j)
            const [minFoundIndex, setMinFoundIndex] = useState(null); // The current minimum found
            const [userSelectedIndex, setUserSelectedIndex] = useState(null); // What the user clicked

            const [message, setMessage] = useState("Welcome! Choose a mode to start.");
            const [score, setScore] = useState(0);
            const [mistakes, setMistakes] = useState(0);
            
            // Speed Control
            const [speedMode, setSpeedMode] = useState('NORMAL');
            const speedRef = useRef(SPEEDS.NORMAL); // Use Ref to allow changing speed mid-sort

            // Refs for auto sorting loop cancellation
            const sortingRef = useRef(false);

            // --- Initialization ---
            useEffect(() => {
                generateNewArray();
            }, []);

            const generateNewArray = () => {
                const newArr = Array.from({ length: ARRAY_SIZE }, () => 
                    Math.floor(Math.random() * (MAX_VAL - MIN_VAL + 1)) + MIN_VAL
                );
                setArray(newArr);
                resetState();
                setMessage("Array generated. Ready to sort!");
            };

            const resetState = () => {
                sortingRef.current = false;
                setSortedIndex(0);
                setCurrentIndex(null);
                setMinFoundIndex(null);
                setUserSelectedIndex(null);
                setGameState('IDLE');
                setPlayPhase('FIND_MIN');
                setScore(0);
                setMistakes(0);
            };

            const changeSpeed = (mode) => {
                setSpeedMode(mode);
                speedRef.current = SPEEDS[mode];
            };

            // --- Auto Sort Logic ---
            const sleep = (ms) => new Promise(resolve => setTimeout(resolve, ms));

            const startAutoSort = async () => {
                if (gameState === 'AUTO_SORT') return;
                setGameState('AUTO_SORT');
                sortingRef.current = true;
                setMessage("Scanning for the smallest number...");

                let arr = [...array];
                const n = arr.length;

                for (let i = 0; i < n - 1; i++) {
                    if (!sortingRef.current) break;

                    setSortedIndex(i);
                    let minIdx = i;
                    setMinFoundIndex(minIdx);
                    
                    // Scan rest of array
                    for (let j = i + 1; j < n; j++) {
                        if (!sortingRef.current) break;
                        setCurrentIndex(j);
                        // Use ref for dynamic speed updates
                        await sleep(speedRef.current);

                        if (arr[j] < arr[minIdx]) {
                            minIdx = j;
                            setMinFoundIndex(minIdx);
                            // Visual feedback for new min
                            await sleep(speedRef.current / 2);
                        }
                    }

                    // Swap
                    if (minIdx !== i) {
                        if (!sortingRef.current) break;
                        let temp = arr[i];
                        arr[i] = arr[minIdx];
                        arr[minIdx] = temp;
                        setArray([...arr]);
                        setMessage(`Swapped ${temp} with ${arr[i]}!`);
                        await sleep(speedRef.current);
                    }
                }

                if (sortingRef.current) {
                    setSortedIndex(n);
                    setCurrentIndex(null);
                    setMinFoundIndex(null);
                    setGameState('WON');
                    setMessage("Sorting Complete!");
                }
            };

            // --- Interactive Game Logic ---

            const startPlaying = () => {
                // If array is already sorted, regen
                if (sortedIndex >= array.length - 1) {
                    generateNewArray();
                } else {
                    setSortedIndex(0);
                    setCurrentIndex(null);
                    setMinFoundIndex(null);
                    setUserSelectedIndex(null);
                }
                
                setGameState('PLAYING');
                setPlayPhase('FIND_MIN');
                setScore(0);
                setMistakes(0);
                setMessage("LEVEL 1: Click the SMALLEST bar in the blue area.");
            };

            const handleBarClick = (index) => {
                if (gameState !== 'PLAYING') return;
                if (index < sortedIndex) return; // Ignore sorted part

                if (playPhase === 'FIND_MIN') {
                    // Logic: User must find the absolute minimum in array[sortedIndex...end]
                    let actualMinIndex = sortedIndex;
                    for (let i = sortedIndex + 1; i < array.length; i++) {
                        if (array[i] < array[actualMinIndex]) {
                            actualMinIndex = i;
                        }
                    }

                    if (index === actualMinIndex) {
                        // Correct!
                        setUserSelectedIndex(index);
                        setMinFoundIndex(index);
                        setPlayPhase('SWAP_TARGET');
                        setScore(s => s + 10);
                        setMessage("Correct! Now click the FIRST unsorted position (the flashing slot) to swap.");
                    } else {
                        // Wrong
                        setMistakes(m => m + 1);
                        setScore(s => Math.max(0, s - 5));
                        setMessage("Not the smallest! Look closer.");
                    }
                } 
                else if (playPhase === 'SWAP_TARGET') {
                    // User must click sortedIndex to confirm the swap placement
                    if (index === sortedIndex) {
                        // Perform swap
                        const newArr = [...array];
                        const temp = newArr[sortedIndex];
                        newArr[sortedIndex] = newArr[userSelectedIndex];
                        newArr[userSelectedIndex] = temp;
                        
                        setArray(newArr);
                        setScore(s => s + 10);
                        
                        // Advance
                        const nextSortedIndex = sortedIndex + 1;
                        setSortedIndex(nextSortedIndex);
                        setUserSelectedIndex(null);
                        setMinFoundIndex(null);

                        if (nextSortedIndex >= array.length - 1) {
                            setGameState('WON');
                            setMessage(`Victory! Final Score: ${score + 10}`);
                            setSortedIndex(array.length); // All sorted
                        } else {
                            setPlayPhase('FIND_MIN');
                            setMessage("Great! Now find the SMALLEST bar in the REMAINING blue area.");
                        }
                    } else {
                        setMessage("Wrong target! You must swap it into the FIRST available slot (leftmost blue bar).");
                    }
                }
            };

            // --- Render Helpers ---

            const getBarColor = (index, value) => {
                if (gameState === 'WON') return 'bg-green-500';
                if (index < sortedIndex) return 'bg-green-600';

                if (gameState === 'PLAYING') {
                    if (playPhase === 'SWAP_TARGET') {
                        if (index === userSelectedIndex) return 'bg-purple-500 ring-4 ring-purple-300';
                        if (index === sortedIndex) return 'bg-yellow-400 animate-pulse cursor-pointer';
                    }
                    if (playPhase === 'FIND_MIN') {
                         return 'bg-blue-500 hover:bg-blue-400 cursor-pointer';
                    }
                    if (index === userSelectedIndex) return 'bg-purple-500';
                }

                if (gameState === 'AUTO_SORT') {
                    if (index === minFoundIndex) return 'bg-purple-500'; 
                    if (index === currentIndex) return 'bg-yellow-400'; 
                    if (index === sortedIndex) return 'bg-blue-400 border-2 border-white'; 
                }

                return 'bg-blue-600';
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-4">
                    
                    {/* Header */}
                    <div className="text-center mb-6">
                        <h1 className="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 mb-2">
                            Valtorta College Selection Sort Master
                        </h1>
                        <p className="text-slate-600 text-sm md:text-base max-w-lg mx-auto">
                            Learn how computers sort data by finding the smallest number and moving it to the front, one by one.
                        </p>
                    </div>

                    {/* Game Container */}
                    <div className="w-full max-w-4xl bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                        
                        {/* Top Bar: Stats & Info */}
                        <div className="flex flex-col md:flex-row justify-between items-center p-4 bg-slate-50 border-b border-slate-200 gap-4">
                            <div className="flex items-center gap-4">
                                <div className="bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm">
                                    <span className="text-slate-500 text-xs uppercase tracking-wider">Status</span>
                                    <div className={`font-bold ${gameState === 'PLAYING' ? 'text-green-600' : 'text-blue-600'}`}>
                                        {gameState === 'IDLE' ? 'Ready' : gameState.replace('_', ' ')}
                                    </div>
                                </div>
                                {gameState === 'PLAYING' && (
                                    <div className="bg-white px-4 py-2 rounded-lg border border-slate-200 shadow-sm">
                                        <span className="text-slate-500 text-xs uppercase tracking-wider">Score</span>
                                        <div className="font-bold text-yellow-500 pixel-font">{score}</div>
                                    </div>
                                )}
                            </div>
                            
                            <div className="bg-white px-4 py-3 rounded-lg border border-slate-200 w-full md:w-auto text-center md:text-left flex-1 mx-4 shadow-sm">
                                <p className="text-sm font-medium text-slate-700 flex items-center justify-center md:justify-start gap-2">
                                    <Icon name="info" className="w-4 h-4 text-blue-500" />
                                    {message}
                                </p>
                            </div>
                        </div>

                        {/* Visualization Area */}
                        <div className="h-64 md:h-80 bg-slate-100 relative flex items-end justify-center gap-2 md:gap-4 p-4 md:p-8 border-b border-slate-200">
                            
                            {/* Empty State / Win State Overlay */}
                            {gameState === 'WON' && (
                                <div className="absolute inset-0 z-10 flex flex-col items-center justify-center bg-white/60 backdrop-blur-sm">
                                    <div className="bg-white p-8 rounded-2xl border-2 border-green-500 shadow-2xl text-center animate-bounce-in">
                                        <div className="mx-auto mb-4 w-16 h-16 flex items-center justify-center">
                                             <Icon name="trophy" className="w-16 h-16 text-yellow-500" />
                                        </div>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-2">Sorted Successfully!</h2>
                                        {score > 0 && <p className="text-green-600 pixel-font mb-4">Final Score: {score}</p>}
                                        <button 
                                            onClick={generateNewArray}
                                            className="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-full font-bold transition-colors shadow-lg shadow-green-200"
                                        >
                                            Play Again
                                        </button>
                                    </div>
                                </div>
                            )}

                            {/* Bars */}
                            {array.map((val, idx) => {
                                const heightPercent = (val / MAX_VAL) * 100;
                                return (
                                    <div 
                                        key={idx}
                                        onClick={() => handleBarClick(idx)}
                                        className={`bar-container relative flex flex-col items-center justify-end w-8 md:w-12 group`}
                                        style={{ height: '100%' }}
                                    >
                                        <span className="mb-2 text-xs md:text-sm font-bold text-slate-600 transition-opacity">
                                            {val}
                                        </span>
                                        <div 
                                            className={`w-full rounded-t-md shadow-md ${getBarColor(idx, val)}`}
                                            style={{ height: `${heightPercent}%` }}
                                        >
                                        </div>
                                        
                                        {/* Indicators underneath */}
                                        <div className="absolute -bottom-6 w-full flex justify-center">
                                            {idx === sortedIndex && gameState !== 'WON' && (
                                                <Icon name="arrow-up" className="w-4 h-4 text-blue-600 animate-bounce" />
                                            )}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {/* Controls */}
                        <div className="p-4 md:p-6 bg-white flex flex-col items-center gap-4">
                            
                            {/* Control Row 1: Settings & Reset */}
                            <div className="flex flex-wrap items-center justify-center gap-4 w-full">
                                
                                {/* Speed Control */}
                                <div className="flex items-center gap-1 bg-slate-100 p-1 rounded-lg border border-slate-200">
                                    <div className="px-2 text-slate-400">
                                        <Icon name="gauge" className="w-4 h-4" />
                                    </div>
                                    {['SLOW', 'NORMAL', 'FAST'].map(mode => (
                                        <button
                                            key={mode}
                                            onClick={() => changeSpeed(mode)}
                                            className={`px-3 py-1.5 text-xs font-bold rounded-md transition-all ${
                                                speedMode === mode 
                                                ? 'bg-white shadow-sm text-blue-600' 
                                                : 'text-slate-500 hover:text-slate-700'
                                            }`}
                                        >
                                            {mode}
                                        </button>
                                    ))}
                                </div>

                                <div className="h-8 w-px bg-slate-200 hidden md:block"></div>

                                <button 
                                    onClick={generateNewArray}
                                    disabled={gameState === 'AUTO_SORT'}
                                    className="flex items-center gap-2 px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-slate-700 font-medium transition-colors disabled:opacity-50 border border-slate-200"
                                >
                                    <Icon name="refresh-cw" className="w-4 h-4" />
                                    New Array
                                </button>
                            </div>

                            {/* Control Row 2: Actions */}
                            <div className="flex flex-wrap items-center justify-center gap-4 w-full">
                                <button 
                                    onClick={startAutoSort}
                                    disabled={gameState === 'AUTO_SORT' || gameState === 'PLAYING'}
                                    className="flex items-center gap-2 px-6 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-bold transition-colors shadow-lg shadow-blue-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <Icon name="play" className="w-4 h-4" />
                                    Auto Sort
                                </button>

                                <button 
                                    onClick={startPlaying}
                                    disabled={gameState === 'AUTO_SORT'}
                                    className="flex items-center gap-2 px-6 py-2 rounded-lg bg-purple-600 hover:bg-purple-500 text-white font-bold transition-colors shadow-lg shadow-purple-200 disabled:opacity-50 disabled:cursor-not-allowed"
                                >
                                    <Icon name="gamepad-2" className="w-4 h-4" />
                                    Interactive Mode
                                </button>
                            </div>

                            {/* Legend */}
                            <div className="mt-2 flex flex-wrap justify-center gap-4 text-xs md:text-sm text-slate-500 border-t border-slate-100 pt-4 w-full">
                                <div className="flex items-center gap-2">
                                    <span className="w-3 h-3 bg-green-600 rounded-sm"></span> Sorted
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className="w-3 h-3 bg-blue-600 rounded-sm"></span> Unsorted
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className="w-3 h-3 bg-purple-500 rounded-sm"></span> Minimum Found
                                </div>
                                <div className="flex items-center gap-2">
                                    <span className="w-3 h-3 bg-yellow-400 rounded-sm"></span> Scanner/Target
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>