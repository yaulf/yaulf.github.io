<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bubble Sort Interactive Game</title>
<style>
  :root{
    --bg:#0f1724;
    --panel:#0b1220;
    --accent:#06b6d4;
    --muted:#94a3b8;
    --bar:#60a5fa;
    --bar2:#fb7185;
    --ok:#34d399;
    --danger:#f97316;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,var(--bg),#071027);
    color:#e6eef8;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }
  .app{
    width:100%;
    max-width:1100px;
    background:linear-gradient(180deg,var(--panel),#051225);
    border-radius:12px;
    box-shadow:0 8px 30px rgba(2,6,23,0.6);
    padding:18px;
    display:flex;
    gap:16px;
    flex-wrap:wrap;
  }
  .controls{
    flex:1 1 320px;
    min-width:260px;
    padding:12px;
    border-radius:10px;
    background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
    border:1px solid rgba(255,255,255,0.03);
  }
  .visual{
    flex:2 1 520px;
    min-width:300px;
    padding:12px;
    border-radius:10px;
    background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);
    border:1px solid rgba(255,255,255,0.03);
    display:flex;
    flex-direction:column;
  }
  h1{margin:0 0 6px 0;font-size:18px}
  p.lead{margin:0 0 12px 0;color:var(--muted);font-size:13px}
  .row{display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap}
  label{font-size:13px;color:var(--muted)}
  input[type="range"]{width:100%}
  .btn{
    background:linear-gradient(180deg,var(--accent),#0288a6);
    border:none;color:#012; padding:8px 12px;border-radius:8px;font-weight:600;
    cursor:pointer;box-shadow:0 6px 18px rgba(3,105,125,0.18);
  }
  .btn.secondary{
    background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);box-shadow:none;font-weight:600;
  }
  .btn.danger{background:linear-gradient(180deg,var(--danger),#d04a00);color:#081018}
  .small{padding:6px 8px;font-size:13px;border-radius:7px}
  .info{
    display:flex;gap:10px;align-items:center;margin-top:6px;flex-wrap:wrap;
  }
  .chip{
    background:rgba(255,255,255,0.03);padding:6px 10px;border-radius:999px;font-size:13px;border:1px solid rgba(255,255,255,0.02);
  }
  .canvas{
    height:420px;
    display:flex;
    align-items:flex-end;
    gap:6px;
    padding:12px;
    border-radius:8px;
    margin-top:12px;
    background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));
    position:relative;
    overflow:hidden;
  }
  .bar{
    flex:1 0 auto;
    height:40%;
    background:linear-gradient(180deg,var(--bar),#2563eb);
    border-radius:6px 6px 4px 4px;
    display:flex;
    align-items:flex-end;
    justify-content:center;
    color:rgba(255,255,255,0.95);
    font-weight:700;
    letter-spacing:0.6px;
    box-shadow:0 6px 18px rgba(2,6,23,0.5), inset 0 -6px 14px rgba(255,255,255,0.03);
    transition:all 250ms ease;
    position:relative;
  }
  .bar .label{
    transform:translateY(6px);
    font-size:12px;
    color:rgba(255,255,255,0.9);
  }
  .bar.compare{outline:3px dashed rgba(255,255,255,0.12); transform:translateY(-6px)}
  .bar.swapped{background:linear-gradient(180deg,var(--bar2),#ef4444)}
  .bar.sorted{background:linear-gradient(180deg,var(--ok),#10b981); box-shadow:0 6px 18px rgba(16,185,129,0.12)}
  .legend{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .legend-item{display:flex;gap:6px;align-items:center;font-size:13px;color:var(--muted)}
  .colorbox{width:18px;height:12px;border-radius:4px;background:var(--bar);border:1px solid rgba(255,255,255,0.03)}
  .colorbox.swapped{background:var(--bar2)}
  .colorbox.sorted{background:var(--ok)}
  .footer{
    margin-top:8px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:8px;
    flex-wrap:wrap;
  }
  .status{font-size:13px;color:var(--muted)}
  .big{
    font-size:22px;font-weight:700;color:#e6eef8;
  }
  .hint{font-size:13px;color:var(--muted);margin-top:8px}
  /* responsive */
  @media (max-width:800px){
    .canvas{height:300px}
  }
  @media (max-width:520px){
    .app{padding:12px}
    .controls,.visual{flex-basis:100%}
    .canvas{height:260px}
  }
</style>
</head>
<body>
<div class="app" role="application" aria-label="Bubble sort interactive game">
  <div class="controls" aria-hidden="false">
    <h1>Bubble Sort — Interactive Game</h1>
    <p class="lead">Visualize bubble sort by stepping through comparisons and swaps. Try different sizes and speeds.</p>

    <div class="row">
      <label for="size">Array size</label>
      <input id="size" type="range" min="4" max="30" value="12" />
      <div class="chip" id="sizeVal">12</div>
    </div>

    <div class="row">
      <label for="speed">Speed (ms per step)</label>
      <input id="speed" type="range" min="50" max="1200" step="10" value="300" />
      <div class="chip" id="speedVal">300ms</div>
    </div>

    <div class="row">
      <button id="shuffleBtn" class="btn small">Shuffle</button>
      <button id="nextBtn" class="btn secondary small">Next Step</button>
      <button id="playBtn" class="btn small">Auto Play</button>
      <button id="resetBtn" class="btn danger small">Reset</button>
    </div>

    <div class="row">
      <div class="chip">Comparisons: <span id="comp">0</span></div>
      <div class="chip">Swaps: <span id="swp">0</span></div>
      <div class="chip">i (pass): <span id="pass">0</span></div>
      <div class="chip">j (index): <span id="idx">0</span></div>
    </div>

    <div class="hint">
      Tips:
      <ul style="margin:6px 0 0 18px;color:var(--muted);padding:0">
        <li>Bubble sort repeatedly compares neighbors and swaps if out of order.</li>
        <li>After each full pass largest unsorted item moves to its correct place.</li>
      </ul>
    </div>
  </div>

  <div class="visual">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div class="big" id="title">Bubble Sort</div>
        <div class="status" id="status">Status: Ready</div>
      </div>
      <div style="text-align:right">
        <div class="legend">
          <div class="legend-item"><div class="colorbox"></div> Comparing</div>
          <div class="legend-item"><div class="colorbox swapped"></div> Swapped</div>
          <div class="legend-item"><div class="colorbox sorted"></div> Sorted</div>
        </div>
      </div>
    </div>

    <div class="canvas" id="canvas" aria-live="polite" aria-atomic="true"></div>

    <div class="footer">
      <div class="chip" id="explain">Explanation: Click Next or Auto Play to proceed.</div>
      <div>
        <button id="explainBtn" class="btn secondary small">Show Explanation</button>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  // Utilities
  const el = id => document.getElementById(id);
  const canvas = el('canvas');
  let arr = [];
  let size = parseInt(el('size').value,10);
  let speed = parseInt(el('speed').value,10);
  let comparisons = 0;
  let swaps = 0;
  let iPass = 0; // current outer pass (0-based)
  let jIdx = 0; // current inner index (0-based)
  let playing = false;
  let timer = null;
  let sorted = false;

  // DOM refs
  const sizeVal = el('sizeVal');
  const speedVal = el('speedVal');
  const compEl = el('comp');
  const swpEl = el('swp');
  const passEl = el('pass');
  const idxEl = el('idx');
  const statusEl = el('status');
  const explainEl = el('explain');
  const explainBtn = el('explainBtn');

  // Initialize
  function initArray(n){
    arr = [];
    for(let k=0;k<n;k++){
      arr.push(Math.floor(Math.random()*100)+5);
    }
    comparisons = 0;
    swaps = 0;
    iPass = 0;
    jIdx = 0;
    playing = false;
    sorted = false;
    updateStats();
    render();
    setStatus('Ready');
  }

  function updateStats(){
    compEl.textContent = comparisons;
    swpEl.textContent = swaps;
    passEl.textContent = iPass;
    idxEl.textContent = jIdx;
    sizeVal.textContent = arr.length;
    speedVal.textContent = speed + 'ms';
  }

  // Render bars
  function render(highlight = {}) {
    // highlight: { compare: [i,j], swapped: [i,j], sortedIndex: k }
    canvas.innerHTML = '';
    const n = arr.length;
    const max = Math.max(...arr);
    for(let k=0;k<n;k++){
      const value = arr[k];
      const bar = document.createElement('div');
      bar.className = 'bar';
      // width adapted; use flex basis with min width:
      bar.style.flex = `1 0 calc(${100/n}% - 6px)`;
      // height based on value
      const pct = Math.max(6, Math.round((value / max) * 100));
      bar.style.height = pct + '%';
      const label = document.createElement('div');
      label.className = 'label';
      label.textContent = value;
      bar.appendChild(label);

      if(highlight.compare && (highlight.compare[0]===k || highlight.compare[1]===k)){
        bar.classList.add('compare');
      }
      if(highlight.swapped && (highlight.swapped[0]===k || highlight.swapped[1]===k)){
        bar.classList.add('swapped');
      }
      if(typeof highlight.sortedFrom === 'number' && k >= highlight.sortedFrom){
        bar.classList.add('sorted');
      }
      canvas.appendChild(bar);
    }
  }

  // Bubble sort single step (one comparison, maybe swap)
  // Returns an object with action info
  function stepBubble() {
    const n = arr.length;
    if(sorted) return {done:true};

    if(iPass >= n-1){
      // fully sorted
      sorted = true;
      setStatus('Sorted — complete!');
      render({sortedFrom:0});
      return {done:true};
    }

    // If jIdx has reached end for this pass, finish pass
    if(jIdx >= n - 1 - iPass){
      // this pass finished; mark the last element as sorted portion
      iPass += 1;
      jIdx = 0;
      updateStats();
      setStatus(`Completed pass ${iPass} — largest ${iPass} element(s) in place`);
      // Render to show sorted tail
      render({sortedFrom: n - iPass});
      // If after increment we've completed all passes:
      if(iPass >= n-1){
        sorted = true;
        setStatus('Sorted — complete!');
        render({sortedFrom:0});
        return {done:true};
      }
      return {action:'passComplete'};
    }

    // Compare arr[jIdx] and arr[jIdx+1]
    comparisons++;
    let swapped = false;
    if(arr[jIdx] > arr[jIdx+1]){
      // swap
      const tmp = arr[jIdx];
      arr[jIdx] = arr[jIdx+1];
      arr[jIdx+1] = tmp;
      swaps++;
      swapped = true;
    }
    // prepare highlight & increment j
    const comparePair = [jIdx, jIdx+1];
    const action = swapped ? 'swap' : 'compare';
    // render showing comparison (and swap color)
    render({compare: comparePair, swapped: swapped ? comparePair : null, sortedFrom: arr.length - iPass});
    jIdx++;
    updateStats();
    setStatus(swapped ? `Swapped indices ${comparePair[0]} and ${comparePair[1]}` : `Compared indices ${comparePair[0]} and ${comparePair[1]}`);
    // after this comparison, if jIdx reached end, next call will finish pass
    return {action, comparePair, swapped};
  }

  // Controls
  function nextStep(){
    if(sorted) {
      setStatus('Already sorted — Reset or Shuffle to try again.');
      return;
    }
    const res = stepBubble();
    // If the step produced a swap highlight, keep it visible a bit
    // (render already called inside stepBubble)
  }

  function autoPlayStart(){
    if(sorted){ setStatus('Already sorted — Reset or Shuffle to try again.'); return;}
    if(playing) return;
    playing = true;
    el('playBtn').textContent = 'Pause';
    setStatus('Auto playing...');
    timer = setInterval(()=>{
      if(!playing) return;
      nextStep();
      if(sorted){
        autoPlayStop();
        return;
      }
    }, speed);
  }
  function autoPlayStop(){
    playing = false;
    el('playBtn').textContent = 'Auto Play';
    if(timer){ clearInterval(timer); timer = null; }
    setStatus(sorted ? 'Sorted — complete!' : 'Paused');
  }

  function shuffle(){
    // Fisher-Yates shuffle on new random array
    initArray(arr.length);
  }

  function reset(){
    initArray(size);
  }

  function setStatus(text){
    statusEl.textContent = 'Status: ' + text;
    explainEl.textContent = text;
  }

  // Event wiring
  el('size').addEventListener('input', (e)=>{
    size = parseInt(e.target.value,10);
    el('sizeVal').textContent = size;
  });
  el('size').addEventListener('change', (e)=>{
    size = parseInt(e.target.value,10);
    initArray(size);
  });
  el('speed').addEventListener('input', (e)=>{
    speed = parseInt(e.target.value,10);
    speedVal.textContent = speed + 'ms';
    if(playing){
      // restart timer with new speed
      autoPlayStop();
      autoPlayStart();
    }
  });

  el('shuffleBtn').addEventListener('click', ()=>{
    shuffle();
  });
  el('resetBtn').addEventListener('click', ()=>{
    reset();
  });
  el('nextBtn').addEventListener('click', ()=>{
    nextStep();
  });
  el('playBtn').addEventListener('click', ()=>{
    if(playing) autoPlayStop(); else autoPlayStart();
  });
  explainBtn.addEventListener('click', ()=>{
    explainEl.textContent = `Step explanation: i (pass) = ${iPass}. j (index) = ${Math.max(0,jIdx-1)}. On each comparison we compare neighbors and swap if left > right. After each pass the largest unsorted item "bubbles" to the end.`;
  });

  // Keyboard shortcuts
  document.addEventListener('keydown',(e)=>{
    if(e.key === ' '){
      e.preventDefault();
      if(playing) autoPlayStop(); else autoPlayStart();
    } else if(e.key === 'ArrowRight'){
      nextStep();
    } else if(e.key === 'r' || e.key === 'R'){
      reset();
    } else if(e.key === 's' || e.key === 'S'){
      shuffle();
    }
  });

  // Initialize first time
  initArray(size);

  // Accessibility: describe initial instructions if screen reader
  el('canvas').setAttribute('aria-label','Bars representing array values. Use Next Step or Auto Play to progress bubble sort.');

})();
</script>
</body>
</html>